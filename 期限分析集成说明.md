# 期限分析集成说明

## 功能概述

已成功将虚实比分析功能集成到 OptionAlpha 主界面，作为新的"期限分析"标签页。

## 访问方式

### 本地访问
```
http://localhost:8000/
```
点击顶部导航栏的 **"📈 期限分析"** 标签即可访问

### 公网访问 (Render部署后)
```
https://option-tracker-xqxk.onrender.com/
```
点击顶部导航栏的 **"📈 期限分析"** 标签即可访问

## 标签结构

```
OptionAlpha 主界面
├── 📊 市场总览
├── 🔍 品种详情
├── 📄 研报
├── 💰 资金面
├── 📉 技术面
├── 📈 期限分析 ← 新增
│   ├── 📊 虚实比 ← 完整功能
│   └── 📈 期限结构 ← 预留位置
└── 📰 消息面
```

## 虚实比子标签功能

### 1. 统计概览卡片
- **总品种数**: 显示当前有数据的品种总数
- **高风险品种**: 虚实比 > 100 的品种数量
- **中风险品种**: 虚实比 50-100 的品种数量
- **低风险品种**: 虚实比 20-50 的品种数量

### 2. 高风险品种预警
- 自动显示高风险品种列表
- 每个品种卡片展示:
  - 品种名称和代码
  - 虚实比数值（红色高亮）
  - 风险影响分析
- 点击卡片可查看详细信息

### 3. 虚实比排行榜
功能特性:
- ✅ 按虚实比降序排列
- ✅ 风险等级筛选（高/中/低/无）
- ✅ 支持列排序（虚实比、较上期变化等）
- ✅ 品种列固定，方便查看长列表

展示字段:
| 字段 | 说明 |
|------|------|
| **品种** | 品种名称和代码 |
| **虚实比** | 当前虚实比数值，>100红色显示 |
| **较上期** | 变化百分比和数值，红色↑表示风险上升，绿色↓表示风险下降 |
| **逼仓风险** | 风险等级标签（高/中/低/无） |
| **仓单量** | 当前仓单量，显示变化百分比（绿色↑供应增加，红色↓供应减少） |
| **持仓量(手)** | 当前持仓量，显示变化百分比（红色↑需求增加，绿色↓需求减少） |
| **价格压力** | 上涨/下跌/中性标签 |
| **影响分析** | 详细文字说明 |

### 4. 数据对比功能
- 自动对比上一交易日数据
- 显示虚实比、仓单量、持仓量的变化百分比
- 颜色编码:
  - 🔴 红色↑: 风险上升
  - 🟢 绿色↓: 风险下降
  - ➡️ 灰色→: 无变化

## 技术实现

### 前端集成
- 新增 `termAnalysisSubTab` 控制子标签切换
- 新增 `vrSummary`, `vrList`, `vrFilterRisk` 数据绑定
- 新增 `loadVRData()` 数据加载函数
- 新增 `getVRRiskType()`, `getVRPressureType()`, `formatNumber()` 工具函数

### 数据懒加载
- 仅在用户切换到"期限分析"标签时才加载数据
- 避免首页加载时请求过多API
- 优化性能和用户体验

### 日期联动
- 顶部日期选择器更改时，自动刷新虚实比数据
- 与其他标签（研报、资金面、技术面）数据联动

## API端点

### 汇总统计
```
GET /api/v1/virtual-real-ratio/summary?query_date=YYYY-MM-DD
```

### 列表数据
```
GET /api/v1/virtual-real-ratio/list?query_date=YYYY-MM-DD&risk_level=高
```

### 详情数据
```
GET /api/v1/virtual-real-ratio/detail/{comm_code}?query_date=YYYY-MM-DD
```

### 历史趋势
```
GET /api/v1/virtual-real-ratio/history/{comm_code}?days=30
```

## 期限结构子标签

目前为预留位置，显示"期限结构功能开发中..."

未来可扩展为:
- 期货合约期限结构图表
- 正向市场/反向市场分析
- 跨期套利机会识别
- 展期成本计算

## 使用建议

### 快速识别风险
1. 首先查看统计概览卡片，了解整体风险分布
2. 如有高风险品种，查看预警区域的详细信息
3. 在排行榜中按虚实比排序，关注最高的品种

### 分析供需变化
查看"较上期"列的变化:
- **虚实比持续上升**: 风险累积，需要警惕
- **仓单增加 + 持仓增加**: 市场活跃，关注比例
- **仓单减少 + 持仓增加**: 供减需增，风险上升

### 风险预警
重点关注以下组合:
- ⚠️ 虚实比 > 100 且连续上升
- ⚠️ 仓单持续下降或不变
- ⚠️ 持仓持续增长
- ⚠️ 临近交割月

## 实际案例

### 2025-12-05 数据
- **铁矿石 (I)**: 虚实比 314.40 (↑5.95%) - 高风险持续恶化
- **豆粕 (M)**: 虚实比 74.84 (↑3.13%) - 中风险逐步加剧
- **豆油 (Y)**: 虚实比 22.73 (↓16.98%) - 风险显著缓解

详细分析参见: `虚实比对比功能说明.md`

## 技术栈

- **前端框架**: Vue 3 (Composition API)
- **UI组件**: Element Plus
- **图表库**: ECharts
- **CSS框架**: Tailwind CSS
- **后端API**: FastAPI
- **数据库**: SQLAlchemy ORM
- **数据源**: AKShare (中国财经数据)

## 部署说明

推送到 GitHub 后，Render 会自动触发部署:
1. 检测到 `frontend.html` 变更
2. 自动构建并部署
3. 约 2-5 分钟后生效

查看部署状态:
```
https://dashboard.render.com/
```

---

## 更新日志

**2025-12-07**:
- ✅ 新增"期限分析"主标签
- ✅ 集成虚实比完整功能
- ✅ 添加数据懒加载机制
- ✅ 实现日期选择器联动
- ✅ 保留期限结构扩展位置
- ✅ 优化表格展示和交互
